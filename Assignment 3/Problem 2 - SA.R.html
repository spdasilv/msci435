<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/1999/REC-html401-19991224/strict.dtd">
<html>
<head>
<META http-equiv=Content-Type content="text/html; charset=UTF-8">
<title>Exported from Notepad++</title>
<style type="text/css">
span {
	font-family: 'Courier New';
	font-size: 10pt;
	color: #000000;
}
.sc0 {
}
.sc1 {
	color: #008000;
}
.sc2 {
	font-weight: bold;
	color: #0000FF;
}
.sc3 {
	color: #8000FF;
}
.sc5 {
	color: #FF8000;
}
.sc8 {
	font-weight: bold;
	color: #000080;
}
.sc9 {
}
</style>
</head>
<body>
<div style="float: left; white-space: pre; line-height: 1; background: #FFFFFF; "><span class="sc1">### Simulated Annealing ###</span><span class="sc0">

</span><span class="sc1">#This function generates a solution using First Fit Algorithm.</span><span class="sc0">
</span><span class="sc1">#Once the solution is generated, the energy is caculated.</span><span class="sc0">
</span><span class="sc1">#In this case, the energy can be described as the number of bins.</span><span class="sc0">
</span><span class="sc9">get.energy</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc2">function</span><span class="sc8">(</span><span class="sc9">X</span><span class="sc0">, </span><span class="sc9">weight</span><span class="sc0">, </span><span class="sc9">V</span><span class="sc8">){</span><span class="sc0">
  </span><span class="sc9">unpacked.items</span><span class="sc0"> </span><span class="sc8">&lt;-</span><span class="sc0"> </span><span class="sc3">vector</span><span class="sc8">()</span><span class="sc0">
  </span><span class="sc9">topack.items</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">X</span><span class="sc0">
  </span><span class="sc9">bins</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc5">0</span><span class="sc0">
  </span><span class="sc9">packed.items</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc5">0</span><span class="sc0">
  </span><span class="sc9">curr_bin</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc5">0</span><span class="sc0">
  </span><span class="sc2">while</span><span class="sc0"> </span><span class="sc8">(</span><span class="sc9">packed.items</span><span class="sc0"> </span><span class="sc8">&lt;</span><span class="sc0"> </span><span class="sc5">10</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc8">{</span><span class="sc0">
    </span><span class="sc9">bins</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">bins</span><span class="sc0"> </span><span class="sc8">+</span><span class="sc0"> </span><span class="sc5">1</span><span class="sc0">
    </span><span class="sc9">curr_bin</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc5">0</span><span class="sc0">
    </span><span class="sc2">for</span><span class="sc0"> </span><span class="sc8">(</span><span class="sc9">i</span><span class="sc0"> </span><span class="sc2">in</span><span class="sc0"> </span><span class="sc5">1</span><span class="sc8">:</span><span class="sc3">length</span><span class="sc8">(</span><span class="sc9">topack.items</span><span class="sc8">))</span><span class="sc0"> </span><span class="sc8">{</span><span class="sc0">
      </span><span class="sc2">if</span><span class="sc0"> </span><span class="sc8">(</span><span class="sc9">curr_bin</span><span class="sc0"> </span><span class="sc8">+</span><span class="sc0"> </span><span class="sc9">weight</span><span class="sc8">[</span><span class="sc9">topack.items</span><span class="sc8">[</span><span class="sc9">i</span><span class="sc8">]]</span><span class="sc0"> </span><span class="sc8">&lt;=</span><span class="sc0"> </span><span class="sc9">V</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc8">{</span><span class="sc0">
        </span><span class="sc9">curr_bin</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">curr_bin</span><span class="sc0"> </span><span class="sc8">+</span><span class="sc0"> </span><span class="sc9">weight</span><span class="sc8">[</span><span class="sc9">topack.items</span><span class="sc8">[</span><span class="sc9">i</span><span class="sc8">]]</span><span class="sc0">
        </span><span class="sc9">curr_bin</span><span class="sc0">
        </span><span class="sc9">packed.items</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">packed.items</span><span class="sc0"> </span><span class="sc8">+</span><span class="sc0"> </span><span class="sc5">1</span><span class="sc0">
      </span><span class="sc8">}</span><span class="sc0"> </span><span class="sc2">else</span><span class="sc0"> </span><span class="sc8">{</span><span class="sc0">
        </span><span class="sc9">unpacked.items</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc3">cbind</span><span class="sc8">(</span><span class="sc9">unpacked.items</span><span class="sc0">, </span><span class="sc9">topack.items</span><span class="sc8">[</span><span class="sc9">i</span><span class="sc8">])</span><span class="sc0">
      </span><span class="sc8">}</span><span class="sc0">
    </span><span class="sc8">}</span><span class="sc0">
    </span><span class="sc9">topack.items</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">unpacked.items</span><span class="sc0">
    </span><span class="sc9">unpacked.items</span><span class="sc0"> </span><span class="sc8">&lt;-</span><span class="sc0"> </span><span class="sc3">vector</span><span class="sc8">()</span><span class="sc0">
  </span><span class="sc8">}</span><span class="sc0">
  
  </span><span class="sc9">bins</span><span class="sc0">
</span><span class="sc8">}</span><span class="sc0">

</span><span class="sc1">#This function generates a new neighbor.</span><span class="sc0">
</span><span class="sc1">#A neighbor of the current design vector is the current design vector with two items swapped.</span><span class="sc0">
</span><span class="sc9">get.neighbor</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc2">function</span><span class="sc8">(</span><span class="sc9">X</span><span class="sc8">){</span><span class="sc0">
  </span><span class="sc9">swap</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc3">sample</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">:</span><span class="sc5">10</span><span class="sc0">, </span><span class="sc5">2</span><span class="sc0">, </span><span class="sc3">replace</span><span class="sc8">=</span><span class="sc9">F</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc3">replace</span><span class="sc8">(</span><span class="sc9">X</span><span class="sc0">,</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc9">swap</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc8">]</span><span class="sc0">, </span><span class="sc9">swap</span><span class="sc8">[</span><span class="sc5">2</span><span class="sc8">])</span><span class="sc0">, </span><span class="sc9">X</span><span class="sc8">[</span><span class="sc3">c</span><span class="sc8">(</span><span class="sc9">swap</span><span class="sc8">[</span><span class="sc5">2</span><span class="sc8">]</span><span class="sc0">, </span><span class="sc9">swap</span><span class="sc8">[</span><span class="sc5">1</span><span class="sc8">])])</span><span class="sc0">
</span><span class="sc8">}</span><span class="sc0">

</span><span class="sc1">#Initializing parameters</span><span class="sc0">
</span><span class="sc9">T_j</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc5">1000</span><span class="sc0">
</span><span class="sc9">schedule</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc5">10</span><span class="sc0">
</span><span class="sc9">cooler</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc5">0.8</span><span class="sc0">
</span><span class="sc9">max.iter</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc5">10</span><span class="sc0">

</span><span class="sc9">weight</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">10</span><span class="sc0">,</span><span class="sc5">20</span><span class="sc0">,</span><span class="sc5">30</span><span class="sc0">,</span><span class="sc5">30</span><span class="sc0">,</span><span class="sc5">40</span><span class="sc0">,</span><span class="sc5">50</span><span class="sc0">,</span><span class="sc5">50</span><span class="sc0">,</span><span class="sc5">50</span><span class="sc0">,</span><span class="sc5">70</span><span class="sc0">,</span><span class="sc5">80</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">V</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc5">100</span><span class="sc0">

</span><span class="sc9">X_curr</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc3">c</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc0">,</span><span class="sc5">2</span><span class="sc0">,</span><span class="sc5">3</span><span class="sc0">,</span><span class="sc5">4</span><span class="sc0">,</span><span class="sc5">5</span><span class="sc0">,</span><span class="sc5">6</span><span class="sc0">,</span><span class="sc5">7</span><span class="sc0">,</span><span class="sc5">8</span><span class="sc0">,</span><span class="sc5">9</span><span class="sc0">,</span><span class="sc5">10</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">X_best</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">X_curr</span><span class="sc0">
</span><span class="sc9">E_curr</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">get.energy</span><span class="sc8">(</span><span class="sc9">X_curr</span><span class="sc0">, </span><span class="sc9">weight</span><span class="sc0">, </span><span class="sc9">V</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc9">E_best</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">E_curr</span><span class="sc0">

</span><span class="sc9">schedule.iter</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc5">0</span><span class="sc0">
</span><span class="sc9">iter</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc5">0</span><span class="sc0">
</span><span class="sc9">E_list</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc2">NULL</span><span class="sc0">
</span><span class="sc9">X_list</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">X_curr</span><span class="sc0">
</span><span class="sc9">X_best_list</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">X_curr</span><span class="sc0">

</span><span class="sc1">#This is the main method that calls all other functions.</span><span class="sc0">
</span><span class="sc2">while</span><span class="sc8">(</span><span class="sc9">iter</span><span class="sc0"> </span><span class="sc8">&lt;</span><span class="sc0"> </span><span class="sc9">max.iter</span><span class="sc8">){</span><span class="sc0">
  </span><span class="sc1">#First a neighbor is generated.</span><span class="sc0">
  </span><span class="sc9">X_i</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">get.neighbor</span><span class="sc8">(</span><span class="sc9">X_curr</span><span class="sc8">)</span><span class="sc0">
  
  </span><span class="sc1">#Here the energy function is called.</span><span class="sc0">
  </span><span class="sc1">#The energy value is then appended to the E_list.</span><span class="sc0">
  </span><span class="sc1">#The delta is then caculated.</span><span class="sc0">
  </span><span class="sc9">E_i</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">get.energy</span><span class="sc8">(</span><span class="sc9">X_i</span><span class="sc0">, </span><span class="sc9">weight</span><span class="sc0">, </span><span class="sc9">V</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc9">E_list</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc3">c</span><span class="sc8">(</span><span class="sc9">E_list</span><span class="sc0">, </span><span class="sc9">E_i</span><span class="sc8">)</span><span class="sc0">
  </span><span class="sc9">delta</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0">  </span><span class="sc9">E_i</span><span class="sc0"> </span><span class="sc8">-</span><span class="sc0"> </span><span class="sc9">E_curr</span><span class="sc0">
  
  </span><span class="sc1">#If delta is negative, it means the energy of the neighbor is better than the current energy. Therefore, the neighbor becomes the new current design vector.</span><span class="sc0">
  </span><span class="sc2">if</span><span class="sc8">(</span><span class="sc9">delta</span><span class="sc0"> </span><span class="sc8">&lt;=</span><span class="sc0"> </span><span class="sc5">0</span><span class="sc8">){</span><span class="sc0">
    </span><span class="sc9">X_curr</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">X_i</span><span class="sc0">
    </span><span class="sc9">E_curr</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">E_i</span><span class="sc0">
  </span><span class="sc8">}</span><span class="sc0">
  </span><span class="sc1">#If delta is positive, it means the energy of the neighbor is worse than the current energy. Therefore, the current design vector remains the same.</span><span class="sc0">
  </span><span class="sc2">if</span><span class="sc8">(</span><span class="sc9">delta</span><span class="sc0"> </span><span class="sc8">&gt;</span><span class="sc0"> </span><span class="sc5">0</span><span class="sc8">){</span><span class="sc0">
    </span><span class="sc9">check</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc3">runif</span><span class="sc8">(</span><span class="sc5">1</span><span class="sc8">)</span><span class="sc0">
    </span><span class="sc2">if</span><span class="sc8">(</span><span class="sc9">check</span><span class="sc0"> </span><span class="sc8">&lt;</span><span class="sc0"> </span><span class="sc3">exp</span><span class="sc8">(-</span><span class="sc9">delta</span><span class="sc8">/</span><span class="sc9">T_j</span><span class="sc8">)){</span><span class="sc0">
      </span><span class="sc9">X_curr</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">X_i</span><span class="sc0">
      </span><span class="sc9">E_curr</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">E_i</span><span class="sc0">
    </span><span class="sc8">}</span><span class="sc0">
  </span><span class="sc8">}</span><span class="sc0">
  
  </span><span class="sc2">if</span><span class="sc0"> </span><span class="sc8">(</span><span class="sc9">E_curr</span><span class="sc0"> </span><span class="sc8">&gt;=</span><span class="sc0"> </span><span class="sc9">E_best</span><span class="sc8">)</span><span class="sc0"> </span><span class="sc8">{</span><span class="sc0">
    </span><span class="sc9">E_best</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">E_curr</span><span class="sc0">
    </span><span class="sc9">X_best</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">X_curr</span><span class="sc0">
  </span><span class="sc8">}</span><span class="sc0">
  
  </span><span class="sc9">schedule.iter</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">schedule.iter</span><span class="sc0"> </span><span class="sc8">+</span><span class="sc0"> </span><span class="sc5">1</span><span class="sc0">
  </span><span class="sc2">if</span><span class="sc8">(</span><span class="sc9">schedule.iter</span><span class="sc0"> </span><span class="sc8">==</span><span class="sc0"> </span><span class="sc9">schedule</span><span class="sc8">){</span><span class="sc0">
    </span><span class="sc9">schedule.iter</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc5">0</span><span class="sc0">
    </span><span class="sc9">T_j</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">T_j</span><span class="sc8">*</span><span class="sc9">cooler</span><span class="sc0">
  </span><span class="sc8">}</span><span class="sc0">
  </span><span class="sc9">iter</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc9">iter</span><span class="sc0"> </span><span class="sc8">+</span><span class="sc0"> </span><span class="sc5">1</span><span class="sc0">
  </span><span class="sc9">X_list</span><span class="sc0"> </span><span class="sc8">=</span><span class="sc0"> </span><span class="sc3">cbind</span><span class="sc8">(</span><span class="sc9">X_list</span><span class="sc0">, </span><span class="sc9">X_curr</span><span class="sc8">)</span><span class="sc0">
</span><span class="sc8">}</span><span class="sc0">

</span><span class="sc9">X_best</span><span class="sc0">
</span><span class="sc9">E_best</span></div></body>
</html>
